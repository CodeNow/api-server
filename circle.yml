machine:
  environment:
    NODE_ENV: testing
dependencies:
  cache_directories:
    - "vendor/bundle"
    - "node_modules"
  override:
    - nvm install 0.10.24
    - nvm alias default 0.10.24
    - npm install
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --clean" end':
        pwd: cookbook
        timeout: 99999
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle exec berks install" end': 
        pwd: cookbook
test:
  override:
    - npm test
    - npm run coverage
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle exec rake test" end': 
        pwd: cookbook
        timeout: 99999