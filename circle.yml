machine:
  environment:
    NODE_ENV: testing
dependencies:
  override:
    - nvm install 0.10.24
    - nvm alias default 0.10.24
    - npm install
    - 'echo "$CIRCLE_BRANCH" | grep -q -w -P "(.*chef.*)|(master)" && (bundle check --path=vendor/bundle || bundle install --path=vendor/bundle  --clean) || true':
        pwd: cookbook
        timeout: 99999
    - 'echo "$CIRCLE_BRANCH" | grep -q -w -P "(.*chef.*)|(master)" && (bundle exec berks install) || true ':
        pwd: cookbook
test:
  override:
    - npm test
    - npm run coverage
    - 'echo "$CIRCLE_BRANCH" | grep -q -w -P "(.*chef.*)|(master)" && (bundle exec rake test) || true':
        pwd: cookbook
        timeout: 99999
